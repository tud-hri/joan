<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>JOAN Overview - JOAN documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="https://unpkg.com/mermaid@8.6.0/dist/mermaid.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "JOAN Overview";
        var mkdocs_page_input_path = "firststeps-joan-overview.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> JOAN documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../introduction/">Introduction</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Setup JOAN and CARLA</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../setup-carla-windows/">Build CARLA on Windows</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../setup-joan/">Install JOAN</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../example-usage-and-testing/">Example usage and functionality testing</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">First steps</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">JOAN Overview</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#high-level-joan-structure">High-Level JOAN Structure</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#module">Module</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#data-flow-communication">Data flow &amp; Communication</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#states">States</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#settings">Settings</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#shared-variables">Shared Variables</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#signals">Signals</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#news">News</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#modules-multiprocessing">Modules multiprocessing</a>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../firststeps-joan-run/">Run JOAN and CARLA</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../firststeps-carle-ue4/">Quick start CARLA</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Using the JOAN core modules</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../modules-datarecorder/">Data Recorder</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../modules-carlainterface/">CARLA interface</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../modules-hardwaremanager/">Hardware Manager</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../modules-experimentmanager/">Experiment Manager</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../modules-hapticcontrollermanager/">Haptic Controller Manager</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../modules-dataplotter/">Data Plotter</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Advanced</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../advanced-add-custom-module/">Create custom JOAN modules</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../advanced-settings/">Using JOAN Settings</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../advanced-state-machine/">JOAN State Machine</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Other stuff</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../other-git/">Quick start on using source control (git)</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../other-sensodrive/">A short Sensodrive SENSO Wheel explanation</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Want to contribute?</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../contributing-guidelines/">Guidelines</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../contributing-coding-standard/">Coding Standard</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">JOAN documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>First steps &raquo;</li><li>JOAN Overview</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>

          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="joan-overview">JOAN Overview</h1>
<p>In this section, we try to explain the overall high-level structure of the JOAN framework. Please note that if you are interested
in adding your own modules you need a more thorough understanding than just this section, if that is the case, please
also consult the <a href="../advanced-add-custom-module/">Advanced Steps Section</a> for more information.</p>
<h2 id="high-level-joan-structure">High-Level JOAN Structure</h2>
<p><a href="../imgs/first-steps-highlevel-structure.png" target="_blank"> <img alt="" src="../imgs/first-steps-highlevel-structure.png" /> </a></p>
<p>In the image above you'll notice that JOAN consists mainly of 2 groups, namely the <code>core</code> and the <code>modules</code>. For now
 we'll leave the core be, however, we will go into the modules here. </p>
<h2 id="module">Module</h2>
<p>A module executes a certain function, like recording data or communicating with CARLA. The modules are set up to run in their own process (using the <code>multiprocessing</code> toolbox) to distribute the computational load. For more info on how we set up multiprocessing in JOAN, check out below.</p>
<p>Modules can be anything you want because as it says in the name already JOAN has a modular structure. It is important to know what exactly is contained in a
JOAN Module, this is summarized in the image below:
<a href="../imgs/first-steps-module.png" target="_blank"> <img alt="" src="../imgs/first-steps-module.png" /> </a></p>
<p>The descriptions in the above image are of course a very short summary, for a deeper understanding of what each element
does, and a bit more context please refer to the following explanations:</p>
<ul>
<li><a href="../advanced-add-custom-module/#manager_class" target="_blank">Module Manager</a></li>
<li><a href="../advanced-add-custom-module/#dialog_class" target="_blank">Module Dialog</a></li>
<li><a href="../advanced-add-custom-module/#settings_class" target="_blank">Module Settings</a></li>
<li><a href="../advanced-add-custom-module/#shared_variables_class" target="_blank">Module Shared Variables</a></li>
<li><a href="../advanced-add-custom-module/#process_class" target="_blank">Module Process</a></li>
</ul>
<h2 id="data-flow-communication">Data flow &amp; Communication</h2>
<p>Because of multiprocessing and the modular structure of JOAN the data flow can be a bit difficult to grasp. In this section, we try to shed some light on these topics. A graphic overview is given in the image below, this image is an arbitrary example where we use 2 separate modules, <code>module 1</code> and <code>module 2</code>.
<a href="../imgs/first-steps-communication.png" target="_blank"> <img alt="" src="../imgs/first-steps-communication.png" /> </a>
Please keep the above image in mind when going through the text below, there we will explain the flow of data and JOAN in more detail.</p>
<h3 id="states">States</h3>
<p>The first thing you'll notice is that we have 4 columns of almost the same thing, these represent the different states
JOAN can be in during expected operation; <code>STOPPED</code>, <code>IDLE</code>, <code>READY</code> and <code>RUNNING</code>. This is important because it will give you more insight
into when, how, and why certain communication elements are used. </p>
<h3 id="settings">Settings</h3>
<p>As mentioned earlier every module has its own settings. These settings are made whenever a module is loaded and stored in the <code>Settings()</code> class. 
Loading a module means nothing more than including the module in the main.py of the program via the headquarters. Whenever you have a module loaded it will
have a settings object associated with it, this settings object can get filled with different other setting objects, for example, the
hardware manager module has a base settings object for the module: <code>HardwareManagerSettings()</code>, but inside this object, we have a dictionary
called <code>inputs</code> which contains the setting objects of different types of inputs. For example, it can contain a 
<code>KeyboardSettings()</code> object and 2 <code>JoystickSettings()</code> objects. These specific settings objects are dynamically created and destroyed depending on the state of the module. The way
it goes is as depicted below:</p>
<p><a href="../imgs/first-steps-settingsvsstates.png" target="_blank"> <img alt="" src="../imgs/first-steps-settingsvsstates.png" /> </a></p>
<h3 id="shared-variables">Shared Variables</h3>
<p>The <code>Shared Variables</code> is one of the most essential classes of JOAN. As with the <code>Settings()</code> the creation and removal of these classes
depend on the States as shown below:</p>
<p><a href="../imgs/first-steps-settingsvsharedvariables.png" target="_blank"> <img alt="" src="../imgs/first-steps-settingsvsharedvariables.png" /> </a></p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Shared Variables have to be picklable (serializable)!!</p>
</div>
<h3 id="signals">Signals</h3>
<p>The Signals class in the Default JOAN is a bit obscure, so far it is only used in the <code>activate condition</code> function in the 
experiment manager. This triggers signals so that whenever a condition is activated it updates all dialogs of all included modules.
The Signals class uses the built-in signals &amp; slots functionality from PyQt, so for a deeper understanding please refer to <a href="https://www.tutorialspoint.com/pyqt/pyqt_signals_and_slots.htm" target="_blank">this 
tutorial on signals and slots</a></p>
<h3 id="news">News</h3>
<p>The <code>News()</code> class is used throughout all modules and serves as a sort of message pipe to all modules. It mainly contains the separate <code>shared_variables</code> objects
of all the modules. This is needed because then we can access our shared variables from all modules. For example, if I'd like to calculate something in a separate
<code>calculator</code> module, and for this, I need the input values of a <code>keyboard</code> from the <code>hardwaremanager</code> I can easily access this info in my new module! </p>
<h3 id="modules-multiprocessing">Modules multiprocessing</h3>
<p>JOAN modules are set up to run in their own process using the <code>multiprocessing</code> toolbox. In short, this means that each module will create its own process and communicates with that process once the user hits the "Get ready" and "Run" buttons. The module's functionality (everything that happens in <code>do_while_running(self)</code>) is then executed in a separate process. Communicating with a different process is not trivial, and we encourage you to check out the <a href="https://docs.python.org/3/library/multiprocessing.html">multiprocessing documentation</a>. </p>
<p>We use shared variable objects to enable communication between the module processes. These shared variables objects only allow you to specify simple data types (ints, floats, a byte array). If you need to add parameters in a module's shared variables object, check out the existing SharedVariables classes of the existing modules. </p>
<p>If you want to use an object both in the module manager class and in the module process class, the object needs to be picklable. Check out how we convert a moduleâ€™s settings class to a dictionary and back to a settings object such that we can also use it in the process itself. </p>
<p><img alt="" src="../imgs/joan-structure-multiprocessing-communication.png" /></p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../example-usage-and-testing/" class="btn btn-neutral float-left" title="Example usage and functionality testing"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../firststeps-joan-run/" class="btn btn-neutral float-right" title="Run JOAN and CARLA">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../example-usage-and-testing/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../firststeps-joan-run/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="https://unpkg.com/mermaid@8.6.0/dist/mermaid.min.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
